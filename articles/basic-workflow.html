<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Basic workflow • cwi</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Basic workflow">
<meta property="og:description" content="cwi">
<meta property="og:image" content="https://CT-Data-Haven.github.io/cwi/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cwi</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/acs-updates.html">ACS updates</a>
    </li>
    <li>
      <a href="../articles/basic-workflow.html">Basic workflow</a>
    </li>
    <li>
      <a href="../articles/crosstabs.html">Working with Community Wellbeing Survey crosstabs</a>
    </li>
    <li>
      <a href="../articles/shapefiles.html">Shapefiles</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/CT-Data-Haven/cwi/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="basic-workflow_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Basic workflow</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/CT-Data-Haven/cwi/blob/HEAD/vignettes/basic-workflow.Rmd" class="external-link"><code>vignettes/basic-workflow.Rmd</code></a></small>
      <div class="hidden name"><code>basic-workflow.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org" class="external-link">purrr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://camille-s.github.io/camiller" class="external-link">camiller</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/CT-Data-Haven/cwi" class="external-link">cwi</a></span><span class="op">)</span></code></pre></div>
<p>The tables I’m working with are <code>B01003</code>, total population; <code>B03002</code>, race and Latino ethnicity; and <code>B25003</code>, housing tenure. It’s easiest to save these in a named list, then map over the list calling <code><a href="../reference/multi_geo_acs.html">multi_geo_acs()</a></code> for each table number.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">yr</span> <span class="op">&lt;-</span> <span class="fl">2019</span>
<span class="va">table_nums</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
  total_pop <span class="op">=</span> <span class="st">"B01003"</span>, 
  race <span class="op">=</span> <span class="st">"B03002"</span>,
  tenure <span class="op">=</span> <span class="st">"B25003"</span>
<span class="op">)</span></code></pre></div>
<div class="section level1">
<h1 id="fetching-data-from-acs">Fetching data from ACS<a class="anchor" aria-label="anchor" href="#fetching-data-from-acs"></a>
</h1>
<p>I’m pulling out the entries in the <code>cwi</code> dataset <code><a href="../reference/regions.html">cwi::regions</a></code> (a list) to only include the Greater New Haven-area ones. Then I fetch the ACS tables for those regions, their towns, and New Haven County.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gnh_regions</span> <span class="op">&lt;-</span> <span class="va">regions</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Greater New Haven"</span>, <span class="st">"New Haven Inner Ring"</span>, <span class="st">"New Haven Outer Ring"</span><span class="op">)</span><span class="op">]</span>

<span class="va">gnh_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">table_nums</span>, 
    <span class="op">~</span><span class="fu"><a href="../reference/multi_geo_acs.html">multi_geo_acs</a></span><span class="op">(</span>table <span class="op">=</span> <span class="va">.</span>, year <span class="op">=</span> <span class="va">yr</span>, towns <span class="op">=</span> <span class="va">regions</span><span class="op">$</span><span class="va">`Greater New Haven`</span>,
                   regions <span class="op">=</span> <span class="va">gnh_regions</span>, counties <span class="op">=</span> <span class="st">"New Haven"</span>, state <span class="op">=</span> <span class="st">"09"</span><span class="op">)</span><span class="op">)</span>

<span class="va">gnh_data</span><span class="op">$</span><span class="va">total_pop</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 18 × 9</span></span>
<span class="co">#&gt;    geoid      name        variable  estimate   moe level   state county     year</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 09         Connecticut B01003_0…  3<span style="text-decoration: underline;">575</span>074    <span style="color: #BB0000;">NA</span> 1_state <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>         <span style="text-decoration: underline;">2</span>019</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 09009      New Haven … B01003_0…   <span style="text-decoration: underline;">857</span>513    <span style="color: #BB0000;">NA</span> 2_coun… 09    <span style="color: #BB0000;">NA</span>         <span style="text-decoration: underline;">2</span>019</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> <span style="color: #BB0000;">NA</span>         Greater Ne… B01003_0…   <span style="text-decoration: underline;">463</span>682   155 3_regi… <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>         <span style="text-decoration: underline;">2</span>019</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> <span style="color: #BB0000;">NA</span>         New Haven … B01003_0…   <span style="text-decoration: underline;">144</span>487    79 3_regi… <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>         <span style="text-decoration: underline;">2</span>019</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> <span style="color: #BB0000;">NA</span>         New Haven … B01003_0…   <span style="text-decoration: underline;">188</span>864   125 3_regi… <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>         <span style="text-decoration: underline;">2</span>019</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 0900904580 Bethany     B01003_0…     <span style="text-decoration: underline;">5</span>513    19 4_towns 09    New Have…  <span style="text-decoration: underline;">2</span>019</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 0900907310 Branford    B01003_0…    <span style="text-decoration: underline;">28</span>020    32 4_towns 09    New Have…  <span style="text-decoration: underline;">2</span>019</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 0900922910 East Haven  B01003_0…    <span style="text-decoration: underline;">28</span>742    30 4_towns 09    New Have…  <span style="text-decoration: underline;">2</span>019</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 0900934950 Guilford    B01003_0…    <span style="text-decoration: underline;">22</span>216    39 4_towns 09    New Have…  <span style="text-decoration: underline;">2</span>019</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 0900935650 Hamden      B01003_0…    <span style="text-decoration: underline;">60</span>982    49 4_towns 09    New Have…  <span style="text-decoration: underline;">2</span>019</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">11</span> 0900944560 Madison     B01003_0…    <span style="text-decoration: underline;">18</span>113    21 4_towns 09    New Have…  <span style="text-decoration: underline;">2</span>019</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">12</span> 0900947535 Milford     B01003_0…    <span style="text-decoration: underline;">54</span>328    88 4_towns 09    New Have…  <span style="text-decoration: underline;">2</span>019</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">13</span> 0900952070 New Haven   B01003_0…   <span style="text-decoration: underline;">130</span>331    47 4_towns 09    New Have…  <span style="text-decoration: underline;">2</span>019</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">14</span> 0900953890 North Bran… B01003_0…    <span style="text-decoration: underline;">14</span>191    24 4_towns 09    New Have…  <span style="text-decoration: underline;">2</span>019</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">15</span> 0900954870 North Haven B01003_0…    <span style="text-decoration: underline;">23</span>722    25 4_towns 09    New Have…  <span style="text-decoration: underline;">2</span>019</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">16</span> 0900957600 Orange      B01003_0…    <span style="text-decoration: underline;">13</span>934    36 4_towns 09    New Have…  <span style="text-decoration: underline;">2</span>019</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">17</span> 0900982870 West Haven  B01003_0…    <span style="text-decoration: underline;">54</span>763    54 4_towns 09    New Have…  <span style="text-decoration: underline;">2</span>019</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">18</span> 0900987700 Woodbridge  B01003_0…     <span style="text-decoration: underline;">8</span>827    46 4_towns 09    New Have…  <span style="text-decoration: underline;">2</span>019</span></code></pre></div>
<p>Neighborhoods with corresponding tracts or block groups are included for 4 cities (see <code>neighborhood_tracts</code>). Pass those to get neighborhood-level aggregates.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/multi_geo_acs.html">multi_geo_acs</a></span><span class="op">(</span><span class="st">"B01003"</span>, towns <span class="op">=</span> <span class="st">"New Haven"</span>, counties <span class="op">=</span> <span class="st">"New Haven"</span>, neighborhoods <span class="op">=</span> <span class="va">new_haven_tracts</span><span class="op">)</span>
<span class="co">#&gt; Table B01003: TOTAL POPULATION, 2019</span>
<span class="co">#&gt; Geographies included:</span>
<span class="co">#&gt; Neighborhoods: 19 neighborhoods</span>
<span class="co">#&gt; Towns: New Haven</span>
<span class="co">#&gt; Counties: New Haven County</span>
<span class="co">#&gt; State: 09</span>
<span class="co">#&gt; Assuming neighborhood GEOIDs are for tracts</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 26 × 9</span></span>
<span class="co">#&gt;    geoid      name             variable  estimate   moe level state county  year</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 09         Connecticut      B01003_0…  3<span style="text-decoration: underline;">575</span>074    <span style="color: #BB0000;">NA</span> 1_st… <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>      <span style="text-decoration: underline;">2</span>019</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 09009      New Haven County B01003_0…   <span style="text-decoration: underline;">857</span>513    <span style="color: #BB0000;">NA</span> 2_co… 09    <span style="color: #BB0000;">NA</span>      <span style="text-decoration: underline;">2</span>019</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 0900952070 New Haven        B01003_0…   <span style="text-decoration: underline;">130</span>331    47 3_to… 09    New H…  <span style="text-decoration: underline;">2</span>019</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> <span style="color: #BB0000;">NA</span>         Amity            B01003_0…     <span style="text-decoration: underline;">4</span>730   504 4_ne… 09    New H…  <span style="text-decoration: underline;">2</span>019</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> <span style="color: #BB0000;">NA</span>         Annex            B01003_0…     <span style="text-decoration: underline;">7</span>296   851 4_ne… 09    New H…  <span style="text-decoration: underline;">2</span>019</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> <span style="color: #BB0000;">NA</span>         Beaver Hills     B01003_0…     <span style="text-decoration: underline;">4</span>943   461 4_ne… 09    New H…  <span style="text-decoration: underline;">2</span>019</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> <span style="color: #BB0000;">NA</span>         Dixwell          B01003_0…     <span style="text-decoration: underline;">5</span>149   470 4_ne… 09    New H…  <span style="text-decoration: underline;">2</span>019</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> <span style="color: #BB0000;">NA</span>         Downtown         B01003_0…     <span style="text-decoration: underline;">7</span>616   619 4_ne… 09    New H…  <span style="text-decoration: underline;">2</span>019</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> <span style="color: #BB0000;">NA</span>         Dwight           B01003_0…     <span style="text-decoration: underline;">3</span>874   548 4_ne… 09    New H…  <span style="text-decoration: underline;">2</span>019</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> <span style="color: #BB0000;">NA</span>         East Rock        B01003_0…     <span style="text-decoration: underline;">8</span>625  <span style="text-decoration: underline;">1</span>154 4_ne… 09    New H…  <span style="text-decoration: underline;">2</span>019</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 16 more rows</span></span></code></pre></div>
</div>
<div class="section level1">
<h1 id="aggregating-and-analyzing-data">Aggregating and analyzing data<a class="anchor" aria-label="anchor" href="#aggregating-and-analyzing-data"></a>
</h1>
<p>The total population data is very straightforward, as it only has one variable, <code>B01003_001</code>. The tibble returned has the GEOID, except for custom geographies like regions; the name of each geography, including the names of each region; the variable codes; estimates; margins of error at the default 90% confidence level; the geographic level, numbered in order of decreasing size; and the counties of the towns.</p>
<p>The race and ethnicity table will require some calculations, using the brilliantly-titled <a href="https://github.com/camille-s/camiller" class="external-link"><code>camiller</code> package</a>:</p>
<ul>
<li>Using <code><a href="../reference/label_acs.html">label_acs()</a></code>, join the <code>race</code> tibble with the <code>cwi::acs_vars</code> dataset to get variable labels. Oftentimes, these labels need to be separated by their <code>"!!"</code> delimeter.</li>
<li>Group by the geographic level, county, and name.</li>
<li>Call <code><a href="https://camille-s.github.io/camiller/reference/add_grps.html" class="external-link">camiller::add_grps()</a></code> with a list of racial groups and their labels’ positions in the <code>label</code> column. This gives estimates and, optionally, margins of error for aggregates</li>
<li>
<code><a href="https://camille-s.github.io/camiller/reference/calc_shares.html" class="external-link">camiller::calc_shares()</a></code> then gives shares of each group’s estimate over the <code>"total"</code> denominator.</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gnh_data</span><span class="op">$</span><span class="va">race</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/label_acs.html">label_acs</a></span><span class="op">(</span>year <span class="op">=</span> <span class="va">yr</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">level</span>, <span class="va">county</span>, <span class="va">name</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://camille-s.github.io/camiller/reference/add_grps.html" class="external-link">add_grps</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>total <span class="op">=</span> <span class="fl">1</span>, white <span class="op">=</span> <span class="fl">3</span>, black <span class="op">=</span> <span class="fl">4</span>, latino <span class="op">=</span> <span class="fl">12</span>, other <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span>, group <span class="op">=</span> <span class="va">label</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://camille-s.github.io/camiller/reference/calc_shares.html" class="external-link">calc_shares</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">label</span>, denom <span class="op">=</span> <span class="st">"total"</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 90 × 6</span></span>
<span class="co">#&gt; <span style="color: #949494;"># Groups:   level, county, name [18]</span></span>
<span class="co">#&gt;    level      county name             label  estimate  share</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1_state    <span style="color: #BB0000;">NA</span>     Connecticut      total   3<span style="text-decoration: underline;">575</span>074 <span style="color: #BB0000;">NA</span>    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1_state    <span style="color: #BB0000;">NA</span>     Connecticut      white   2<span style="text-decoration: underline;">392</span>013  0.669</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1_state    <span style="color: #BB0000;">NA</span>     Connecticut      black    <span style="text-decoration: underline;">354</span>120  0.099</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1_state    <span style="color: #BB0000;">NA</span>     Connecticut      latino   <span style="text-decoration: underline;">574</span>240  0.161</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 1_state    <span style="color: #BB0000;">NA</span>     Connecticut      other    <span style="text-decoration: underline;">254</span>701  0.071</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2_counties <span style="color: #BB0000;">NA</span>     New Haven County total    <span style="text-decoration: underline;">857</span>513 <span style="color: #BB0000;">NA</span>    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2_counties <span style="color: #BB0000;">NA</span>     New Haven County white    <span style="text-decoration: underline;">539</span>298  0.629</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2_counties <span style="color: #BB0000;">NA</span>     New Haven County black    <span style="text-decoration: underline;">107</span>111  0.125</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2_counties <span style="color: #BB0000;">NA</span>     New Haven County latino   <span style="text-decoration: underline;">155</span>335  0.181</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2_counties <span style="color: #BB0000;">NA</span>     New Haven County other     <span style="text-decoration: underline;">55</span>769  0.065</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 80 more rows</span></span></code></pre></div>
<p>With the tenure table, it’s easiest to separate the labels by <code>"!!"</code>. Here the table can be wrangled into shares of households that are owner-occupied.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">homeownership</span> <span class="op">&lt;-</span> <span class="va">gnh_data</span><span class="op">$</span><span class="va">tenure</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/label_acs.html">label_acs</a></span><span class="op">(</span>year <span class="op">=</span> <span class="va">yr</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html" class="external-link">separate</a></span><span class="op">(</span><span class="va">label</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"total"</span>, <span class="st">"tenure"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"!!"</span>, fill <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">level</span>, <span class="va">name</span>, <span class="va">tenure</span>, <span class="va">estimate</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">tenure</span> <span class="op">!=</span> <span class="st">"Renter occupied"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">level</span>, <span class="va">name</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://camille-s.github.io/camiller/reference/calc_shares.html" class="external-link">calc_shares</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">tenure</span>, denom <span class="op">=</span> <span class="st">"Total"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">share</span><span class="op">)</span><span class="op">)</span>

<span class="va">homeownership</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 18 × 5</span></span>
<span class="co">#&gt; <span style="color: #949494;"># Groups:   level, name [18]</span></span>
<span class="co">#&gt;    level      name                 tenure         estimate share</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1_state    Connecticut          Owner occupied   <span style="text-decoration: underline;">905</span>681 0.661</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2_counties New Haven County     Owner occupied   <span style="text-decoration: underline;">204</span>451 0.618</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 3_regions  Greater New Haven    Owner occupied   <span style="text-decoration: underline;">106</span>231 0.599</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 3_regions  New Haven Inner Ring Owner occupied    <span style="text-decoration: underline;">33</span>401 0.623</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 3_regions  New Haven Outer Ring Owner occupied    <span style="text-decoration: underline;">59</span>073 0.794</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 4_towns    Bethany              Owner occupied     <span style="text-decoration: underline;">1</span>832 0.908</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 4_towns    Branford             Owner occupied     <span style="text-decoration: underline;">8</span>433 0.682</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 4_towns    East Haven           Owner occupied     <span style="text-decoration: underline;">8</span>102 0.727</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 4_towns    Guilford             Owner occupied     <span style="text-decoration: underline;">7</span>269 0.866</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 4_towns    Hamden               Owner occupied    <span style="text-decoration: underline;">14</span>432 0.639</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">11</span> 4_towns    Madison              Owner occupied     <span style="text-decoration: underline;">5</span>919 0.856</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">12</span> 4_towns    Milford              Owner occupied    <span style="text-decoration: underline;">16</span>720 0.745</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">13</span> 4_towns    New Haven            Owner occupied    <span style="text-decoration: underline;">13</span>757 0.28 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">14</span> 4_towns    North Branford       Owner occupied     <span style="text-decoration: underline;">4</span>570 0.856</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">15</span> 4_towns    North Haven          Owner occupied     <span style="text-decoration: underline;">7</span>406 0.817</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">16</span> 4_towns    Orange               Owner occupied     <span style="text-decoration: underline;">4</span>372 0.879</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">17</span> 4_towns    West Haven           Owner occupied    <span style="text-decoration: underline;">10</span>867 0.546</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">18</span> 4_towns    Woodbridge           Owner occupied     <span style="text-decoration: underline;">2</span>552 0.881</span></code></pre></div>
</div>
<div class="section level1">
<h1 id="visual-sketches">Visual sketches<a class="anchor" aria-label="anchor" href="#visual-sketches"></a>
</h1>
<p><code><a href="../reference/geo_level_plot.html">geo_level_plot()</a></code> gives a quick visual overview of the homeownership rates, highlighting town-level values.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">homeownership</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/geo_level_plot.html">geo_level_plot</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">share</span>, hilite <span class="op">=</span> <span class="st">"darkslateblue"</span>, type <span class="op">=</span> <span class="st">"point"</span><span class="op">)</span></code></pre></div>
<p><img src="basic-workflow_files/figure-html/geo_plot-1.png" width="1050"></p>
<p><code><a href="../reference/acs_quick_map.html">acs_quick_map()</a></code> gives a quick map sketch of the rates. This function uses the Jenks algorithm for making breaks with <code><a href="../reference/jenks.html">jenks()</a></code>. This algorithm is well suited for visually displaying larger inequalities, but the number of breaks you give it won’t necessarily be the number of breaks returned.This function lets us see whether there’s a geographic distribution of this data with minimal work.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tenure_map</span> <span class="op">&lt;-</span> <span class="va">homeownership</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">level</span> <span class="op">==</span> <span class="st">"4_towns"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/acs_quick_map.html">acs_quick_map</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">share</span>, level <span class="op">=</span> <span class="st">"town"</span>, color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">0.4</span>, 
                title <span class="op">=</span> <span class="st">"Homeownership, Greater New Haven"</span>, palette <span class="op">=</span> <span class="st">"BuPu"</span><span class="op">)</span>

<span class="va">tenure_map</span></code></pre></div>
<p><img src="basic-workflow_files/figure-html/quick_map1-1.png" width="1050"></p>
<p>Since this returns a <code>ggplot</code> object with <code>sf</code> data, we can add additional <code>ggplot</code> functions, such as labeling, themes, or additional scales or geoms.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tenure_map</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"By town, 2019"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">.</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"New Haven"</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></code></pre></div>
<p><img src="basic-workflow_files/figure-html/quick_map2-1.png" width="1050"></p>
</div>
<div class="section level1">
<h1 id="batch-output">Batch output<a class="anchor" aria-label="anchor" href="#batch-output"></a>
</h1>
<p>Say as part of a pipeline, you need to do some calculations, write different sections of a data frame to CSV files to pass along to a colleague or refer to later, and then continue on to some more calculations. <code><a href="../reference/batch_csv_dump.html">batch_csv_dump()</a></code> takes either a list of data frames or a data frame plus a column to split by, and writes out a set of CSV files, then lets you move along to the next step in your pipeline.</p>
<p>For example, I need to pull a table of populations by age group for several regions of Connecticut. I don’t need to split populations by gender, so I’ll add up male and female populations for each age group. I don’t actually need to more detailed age groups now, but I need to stash them in files for later, so I’ll aggregate, write a bunch of files, and then aggregate into broader age groups that I need for my current work.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_haven_regions</span> <span class="op">&lt;-</span> <span class="va">regions</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Greater New Haven"</span>, <span class="st">"New Haven Inner Ring"</span>, 
                             <span class="st">"New Haven Outer Ring"</span>, <span class="st">"Lower Naugatuck Valley"</span>, <span class="st">"Greater Waterbury"</span><span class="op">)</span><span class="op">]</span>

<span class="va">acs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/multi_geo_acs.html">multi_geo_acs</a></span><span class="op">(</span>table <span class="op">=</span> <span class="st">"B01001"</span>, year <span class="op">=</span> <span class="va">yr</span>, towns <span class="op">=</span> <span class="cn">NULL</span>, regions <span class="op">=</span> <span class="va">new_haven_regions</span>, 
              counties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"New Haven County"</span>, <span class="st">"Fairfield County"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/label_acs.html">label_acs</a></span><span class="op">(</span>year <span class="op">=</span> <span class="va">yr</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="co"># shortcut around tidyr::separate</span>
  <span class="fu"><a href="../reference/separate_acs.html">separate_acs</a></span><span class="op">(</span>into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sex"</span>, <span class="st">"age"</span><span class="op">)</span>, drop_total <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html" class="external-link">as_factor</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">level</span>, <span class="va">age</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>estimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span>, moe <span class="op">=</span> <span class="fu">tidycensus</span><span class="fu">::</span><span class="fu"><a href="https://walker-data.com/tidycensus/reference/moe_sum.html" class="external-link">moe_sum</a></span><span class="op">(</span><span class="va">moe</span>, <span class="va">estimate</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">acs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">name</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/batch_csv_dump.html">batch_csv_dump</a></span><span class="op">(</span>base_name <span class="op">=</span> <span class="st">"pop_by_age"</span>, bind <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">level</span>, <span class="va">name</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">camiller</span><span class="fu">::</span><span class="fu"><a href="https://camille-s.github.io/camiller/reference/add_grps.html" class="external-link">add_grps</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ages0_4 <span class="op">=</span> <span class="fl">1</span>, ages5_17 <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">4</span>, ages0_17 <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, ages18_24 <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">8</span>, ages0_24 <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span>, group <span class="op">=</span> <span class="va">age</span>, estimate <span class="op">=</span> <span class="va">estimate</span>, moe <span class="op">=</span> <span class="va">moe</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">level</span>, <span class="va">name</span>, <span class="va">age</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level1">
<h1 id="employment-trends">Employment trends<a class="anchor" aria-label="anchor" href="#employment-trends"></a>
</h1>
<div class="section level2">
<h2 id="quarterly-workforce-indicators">Quarterly Workforce Indicators<a class="anchor" aria-label="anchor" href="#quarterly-workforce-indicators"></a>
</h2>
<p>I’m also interested in learning about employment by industry over the past several years. <code><a href="../reference/qwi_industry.html">qwi_industry()</a></code> fetches county-level data by industry over time, either quarterly or annually. Here I’ll look at annual averages of all industries for New Haven County and Connecticut over the past 16 years. I’m filtering out the industry code “00”, which is the counts for all industries.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nhc_employment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/qwi_industry.html">qwi_industry</a></span><span class="op">(</span><span class="fl">2002</span><span class="op">:</span><span class="fl">2018</span>, counties <span class="op">=</span> <span class="st">"009"</span>, annual <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>location <span class="op">=</span> <span class="st">"New Haven County"</span><span class="op">)</span>
<span class="co">#&gt; The API can only get 10 years of data at once; making multiple calls, but this might take a little longer.</span>
<span class="va">ct_employment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/qwi_industry.html">qwi_industry</a></span><span class="op">(</span><span class="fl">2002</span><span class="op">:</span><span class="fl">2018</span>, annual <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>location <span class="op">=</span> <span class="st">"Connecticut"</span><span class="op">)</span>
<span class="co">#&gt; The API can only get 10 years of data at once; making multiple calls, but this might take a little longer.</span>
<span class="va">employment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">nhc_employment</span>, <span class="va">ct_employment</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">industry</span> <span class="op">!=</span> <span class="st">"00"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">naics_codes</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">ind_level</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"industry"</span><span class="op">)</span>

<span class="va">employment</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 680 × 8</span></span>
<span class="co">#&gt;     year industry state county   Emp Payroll location         label             </span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  <span style="text-decoration: underline;">2</span>002 11       09    009      713      <span style="color: #BB0000;">NA</span> New Haven County Agriculture, Fore…</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  <span style="text-decoration: underline;">2</span>002 21       09    009      206      <span style="color: #BB0000;">NA</span> New Haven County Mining, Quarrying…</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  <span style="text-decoration: underline;">2</span>002 22       09    009     <span style="text-decoration: underline;">1</span>919      <span style="color: #BB0000;">NA</span> New Haven County Utilities         </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  <span style="text-decoration: underline;">2</span>002 23       09    009    <span style="text-decoration: underline;">15</span>480      <span style="color: #BB0000;">NA</span> New Haven County Construction      </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  <span style="text-decoration: underline;">2</span>002 31-33    09    009    <span style="text-decoration: underline;">48</span>366      <span style="color: #BB0000;">NA</span> New Haven County Manufacturing     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  <span style="text-decoration: underline;">2</span>002 42       09    009    <span style="text-decoration: underline;">16</span>874      <span style="color: #BB0000;">NA</span> New Haven County Wholesale Trade   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  <span style="text-decoration: underline;">2</span>002 44-45    09    009    <span style="text-decoration: underline;">46</span>246      <span style="color: #BB0000;">NA</span> New Haven County Retail Trade      </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  <span style="text-decoration: underline;">2</span>002 48-49    09    009     <span style="text-decoration: underline;">7</span>775      <span style="color: #BB0000;">NA</span> New Haven County Transportation an…</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  <span style="text-decoration: underline;">2</span>002 51       09    009    <span style="text-decoration: underline;">14</span>417      <span style="color: #BB0000;">NA</span> New Haven County Information       </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  <span style="text-decoration: underline;">2</span>002 52       09    009    <span style="text-decoration: underline;">13</span>351      <span style="color: #BB0000;">NA</span> New Haven County Finance and Insur…</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 670 more rows</span></span></code></pre></div>
<p>Next, say I want to look at the industries that were largest in New Haven county in 2018, and see how those have changed both for the county and statewide over this time period. I’ll filter <code>employment</code>, get the industries with the largest numbers of employees, then filter <code>employment</code> for just those industries and plot it.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">top2018</span> <span class="op">&lt;-</span> <span class="va">employment</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2018</span>, <span class="va">county</span> <span class="op">==</span> <span class="st">"009"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/top_n.html" class="external-link">top_n</a></span><span class="op">(</span><span class="fl">8</span>, <span class="va">Emp</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">industry</span><span class="op">)</span>
<span class="va">top2018</span>
<span class="co">#&gt; [1] "31-33" "42"    "44-45" "54"    "56"    "61"    "62"    "72"</span>

<span class="va">employment</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">industry</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">top2018</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html" class="external-link">str_sub</a></span><span class="op">(</span><span class="va">label</span>, <span class="fl">1</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Emp_1k <span class="op">=</span> <span class="va">Emp</span> <span class="op">/</span> <span class="fl">1000</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">Emp_1k</span>, color <span class="op">=</span> <span class="va">label</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">"Employees (thousands)"</span>, title <span class="op">=</span> <span class="st">"Employment by industry"</span>, 
         subtitle <span class="op">=</span> <span class="st">"Connecticut and New Haven County, 2002-2018"</span>, color <span class="op">=</span> <span class="st">"Industry"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">location</span><span class="op">)</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span></code></pre></div>
<p><img src="basic-workflow_files/figure-html/qwi2-1.png" width="1050"></p>
<p><strong>Update 11/2021:</strong> The QWI API was broken for a little while. It’s up again, but all the payroll data is missing. This code should still be valid if it ever gets returned.</p>
<p>If I’m interested in changes in wages over this period, I can use the <code><a href="../reference/adj_inflation.html">adj_inflation()</a></code> function. This takes a data frame, the name of the column containing dollar amounts, and a base year, then adds two columns for the inflation adjustment factor and the adjusted value.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">employment</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">industry</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">top2018</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html" class="external-link">str_sub</a></span><span class="op">(</span><span class="va">label</span>, <span class="fl">1</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>avg_wage <span class="op">=</span> <span class="va">Payroll</span> <span class="op">/</span> <span class="va">Emp</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/adj_inflation.html">adj_inflation</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">avg_wage</span>, base_year <span class="op">=</span> <span class="fl">2018</span>, year <span class="op">=</span> <span class="va">year</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>adj_wage_1k <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">adj_avg_wage</span> <span class="op">/</span> <span class="fl">1000</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">adj_wage_1k</span>, color <span class="op">=</span> <span class="va">label</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/label_dollar.html" class="external-link">dollar</a></span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">"Average annual wages (thousands)"</span>, title <span class="op">=</span> <span class="st">"Average annual wages by industry (adjusted to 2018 dollars)"</span>, 
         subtitle <span class="op">=</span> <span class="st">"Connecticut and New Haven County, 2002-2018"</span>, color <span class="op">=</span> <span class="st">"Industry"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">location</span><span class="op">)</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span></code></pre></div>
<p>Now we have a visual that shows that in a few industries, wages have climbed over the past several years, but in many industries, wages haven’t increased except by inflation.</p>
</div>
<div class="section level2">
<h2 id="local-area-unemployment-statistics">Local Area Unemployment Statistics<a class="anchor" aria-label="anchor" href="#local-area-unemployment-statistics"></a>
</h2>
<p>To look at unemployment rates over time, I can use <code><a href="../reference/laus_trend.html">laus_trend()</a></code>. The LAUS covers smaller geographies than the QWI, so <code><a href="../reference/laus_trend.html">laus_trend()</a></code> is set up to find data by a combination of state, counties, or towns. The LAUS API returns monthly data on labor force counts, employment counts, unemployed counts, and unemployment rate; <code><a href="../reference/laus_trend.html">laus_trend()</a></code> lets you specify which of these measures to fetch.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">unemployment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/laus_trend.html">laus_trend</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"New Haven"</span>, <span class="st">"New Haven County"</span>, <span class="st">"Connecticut"</span><span class="op">)</span>, startyear <span class="op">=</span> <span class="fl">2000</span>, endyear <span class="op">=</span> <span class="fl">2018</span>, measures <span class="op">=</span> <span class="st">"unemployment rate"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">periodName</span>, <span class="st">"01"</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">value</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">area</span>, <span class="va">date</span>, <span class="va">value</span><span class="op">)</span>

<span class="va">unemployment</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 684 × 3</span></span>
<span class="co">#&gt;    area        date       value</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Connecticut 2018-12-01 0.032</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Connecticut 2018-11-01 0.03 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Connecticut 2018-10-01 0.035</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Connecticut 2018-09-01 0.035</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Connecticut 2018-08-01 0.04 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Connecticut 2018-07-01 0.041</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Connecticut 2018-06-01 0.042</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Connecticut 2018-05-01 0.038</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Connecticut 2018-04-01 0.038</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Connecticut 2018-03-01 0.043</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 674 more rows</span></span>

<span class="va">unemp_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">unemployment</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">area</span>, color <span class="op">=</span> <span class="va">area</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>se <span class="op">=</span> <span class="cn">FALSE</span>, method <span class="op">=</span> <span class="st">"loess"</span>, size <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span>
<span class="va">unemp_plot</span>
<span class="co">#&gt; `geom_smooth()` using formula 'y ~ x'</span></code></pre></div>
<p><img src="basic-workflow_files/figure-html/laus-1.png" width="1050"></p>
</div>
<div class="section level2">
<h2 id="adding-a-logo">Adding a logo<a class="anchor" aria-label="anchor" href="#adding-a-logo"></a>
</h2>
<p>DataHaven’s logo is saved as an SVG file inside this package. (Folks at other orgs who fork this, feel free to replace with your own logo.) <code>add_logo</code> tacks on a logo, either that default, or another image or <code>ggplot</code> grob, making it easier to create distribution-ready plots (which this one is not, tbh).</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/add_logo.html">add_logo</a></span><span class="op">(</span><span class="va">unemp_plot</span>, position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span>
<span class="co">#&gt; `geom_smooth()` using formula 'y ~ x'</span></code></pre></div>
<p><img src="basic-workflow_files/figure-html/logo-1.png" width="1050"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Camille Seaberry.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
